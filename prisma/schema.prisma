generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Member {
  id              String           @id @default(cuid())
  name            String
  email           String?          @unique
  phone           String?
  address         String?
  notes           String?
  joinDate        DateTime         @default(now())

  // New fields
  membership      MembershipType?
  level           LevelType?
  experience      ExperienceType?
  communication   Int?             // 1, 2, or 3
  managementLevel String?
  title           String?
  company         String?
  contact         String?
  memberType      MemberType?
  photo           String?          // URL or path to member photo

  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt

  eventAttendees EventAttendee[]
}

enum MembershipType {
  PREMIUM
  GUEST
  CORE_MEMBER
  FREQUENT_GUEST
  GRAY
  POTENTIAL_GUEST
}

enum LevelType {
  ABOVE
  EQUAL
  BELOW
}

enum ExperienceType {
  EXPERT
  SENIOR
  MED_LEVEL
  JUNIOR
}

enum MemberType {
  EXTERNAL
  CLIENT
  TEAM
}

model Event {
  id          String   @id @default(cuid())
  name        String
  date        DateTime
  location    String?
  description String?
  layoutId    String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  layout     Layout?         @relation(fields: [layoutId], references: [id])
  attendees  EventAttendee[]
}

model EventAttendee {
  id        String  @id @default(cuid())
  memberId  String
  eventId   String
  seatId    String?
  status    AttendeeStatus @default(INVITED)
  createdAt DateTime @default(now())

  member    Member  @relation(fields: [memberId], references: [id], onDelete: Cascade)
  event     Event   @relation(fields: [eventId], references: [id], onDelete: Cascade)
  seat      Seat?   @relation(fields: [seatId], references: [id])

  @@unique([memberId, eventId])
}

model Layout {
  id          String   @id @default(cuid())
  name        String
  description String?
  width       Int      @default(800)
  height      Int      @default(600)
  isTemplate  Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  sections Section[]
  events   Event[]
}

model Section {
  id        String      @id @default(cuid())
  layoutId  String
  name      String
  type      SectionType @default(ROUND_TABLE)
  capacity  Int         @default(8)
  positionX Float       @default(0)
  positionY Float       @default(0)
  rotation  Float       @default(0)
  width     Float       @default(100)
  height    Float       @default(100)
  createdAt DateTime    @default(now())

  layout Layout @relation(fields: [layoutId], references: [id], onDelete: Cascade)
  seats  Seat[]
}

model Seat {
  id        String     @id @default(cuid())
  sectionId String
  label     String
  positionX Float      @default(0)
  positionY Float      @default(0)
  status    SeatStatus @default(AVAILABLE)
  createdAt DateTime   @default(now())

  section   Section         @relation(fields: [sectionId], references: [id], onDelete: Cascade)
  attendees EventAttendee[]
}

enum AttendeeStatus {
  INVITED
  CONFIRMED
  DECLINED
  ATTENDED
  ABSENT
}

enum SectionType {
  ROUND_TABLE
  RECTANGULAR_TABLE
  ROW
  CUSTOM
}

enum SeatStatus {
  AVAILABLE
  RESERVED
  BLOCKED
}
